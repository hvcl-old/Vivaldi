import numpy
from scipy import misc

def heatflow(image, x, y):
	a = laplacian(image, x, y)

	b = point_query_2d(image, x, y)

	dt =  0.25
	ret =  b + dt*a

	return ret

def main():

	print "+++ Loading image ..."
	image = load_data_2d(DATA_PATH+'flower.jpg',float)
#	image = load_data_2d(DATA_PATH+'/Tile_001.png', float)
#	image = misc.lena()
	print "+++ Loading Done!"

	# GPU test

	gpu_list = get_GPU_list(2)

	print "+++ Input & output split test +++"

	# Heatflow iteration
	n = 1
	for i in range(n):
		# original modifier

		# input & output halo test
#		image = heatflow(image, x, y).range(image,halo=n-i-1).execid(gpu_list).split(image, x=2, y=2).halo(image,n-i).dtype(image,float)

		# input halo test
#		image = heatflow(image, x, y).range(image).execid(gpu_list).split(image, x=2, y=2).halo(image,0).dtype(image,float)
#		image = heatflow(image, x, y).range(image, halo=0).execid(gpu_list).split(image, x=2, y=2).halo(image,1).dtype(image,float)
		image = heatflow(image, x, y).range(image).execid(gpu_list).split(image, x=2, y=2).halo(image,1).dtype(image,float).output_halo(0)

#	image = heatflow(image, x, y).range(image,halo=0).execid(gpu_list).split(image, x=2, y=2).halo(image,1).dtype(image,float)
#	image = heatflow(image, x, y).range(image,halo=0).execid(gpu_list).split(image, x=2, y=2).halo(image,1).dtype(image,float)





	synchronize()
	print "+++ Done! +++"
	print "   "

	print "+++ Save image +++"
	save_image(image, "result-heatflow.png")
	print "+++ Done! +++"

#	image[0] = 10
#	print image
